<?php
    global $Locale, $Translate, $MC_URL;
    $errMsg = new Phools_Message_Default('Video player cannot play back this video.');
    $licid = uniqid();
    $styleVideo = 'max-width: 100%; background: transparent url(\''.$previewUrl.'\') 50% 50% / cover no-repeat;';
    if(isset($_REQUEST['width']) && !empty($_REQUEST['width']))
        $styleVideo .= 'width:'.(int)$_REQUEST['width'] . 'px';
    $styleVideoWrapper = 'position:relative;';
    if(isset($_REQUEST['width']) && !empty($_REQUEST['width']))
        $styleVideoWrapper .= 'width:'.(int)$_REQUEST['width'] . 'px';

?>
<style scoped>
    <?php include(dirname(__FILE__) . '/../../css/metadata.css'); ?>
    <?php include(dirname(__FILE__) . '/../../css/inline.php'); ?>
    .playButton{
        background: transparent url('<?php echo $MC_URL?>/theme/default/img/play.svg') 50% 50% / cover no-repeat;
        height: 100px;
        position: absolute;
        width: 100px;
        margin: auto;
        top:0;
        bottom:0;
        right:0;
        left:0;
    }
</style>
<div style="<?php echo $styleVideoWrapper?>">
    <video poster="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" style="<?php echo $styleVideo?>" data-tap-disabled="true" id="<?php echo htmlentities($videoObjectIdentifier, ENT_QUOTES, 'UTF-8') ?>" data-licid="<?php echo $licid;?>" controls controlsList="nodownload" oncontextmenu="return false;">
        <?php
           echo '<source src="' . $url . '" type="video/' . $ext . '"></source>';
        ?>
    </video>
    <div class="playButton" id="b_<?php echo htmlentities($videoObjectIdentifier, ENT_QUOTES, 'UTF-8') ?>"></div>
    <?php echo $footer?>
    <p id="e_<?php echo htmlentities($videoObjectIdentifier, ENT_QUOTES, 'UTF-8') ?>" style="display: none;"><?php echo $errMsg -> localize($Locale, $Translate);?></p>
</div>
<script>
    var video_<?php echo htmlentities($videoObjectIdentifier, ENT_QUOTES, 'UTF-8') ?> = document.getElementById('<?php echo htmlentities($videoObjectIdentifier, ENT_QUOTES, 'UTF-8') ?>');
    video_<?php echo htmlentities($videoObjectIdentifier, ENT_QUOTES, 'UTF-8') ?>.addEventListener(
        'play',
        function() {
            video_<?php echo htmlentities($videoObjectIdentifier, ENT_QUOTES, 'UTF-8') ?>.play();
            document.getElementById('b_<?php echo htmlentities($videoObjectIdentifier, ENT_QUOTES, 'UTF-8') ?>').style.display = 'none';
        },
        false);

    video_<?php echo htmlentities($videoObjectIdentifier, ENT_QUOTES, 'UTF-8') ?>.addEventListener(
        'ended',
        function() {
            document.getElementById('b_<?php echo htmlentities($videoObjectIdentifier, ENT_QUOTES, 'UTF-8') ?>').style.display = 'block';
        },
        false);

    video_<?php echo htmlentities($videoObjectIdentifier, ENT_QUOTES, 'UTF-8') ?>.addEventListener(
        'pause',
        function() {
            document.getElementById('b_<?php echo htmlentities($videoObjectIdentifier, ENT_QUOTES, 'UTF-8') ?>').style.display = 'block';
        },
        false);

    b_<?php echo htmlentities($videoObjectIdentifier, ENT_QUOTES, 'UTF-8') ?>.onclick = function() {
        <?php echo htmlentities($videoObjectIdentifier, ENT_QUOTES, 'UTF-8') ?>.click();
    };
    <?php echo htmlentities($videoObjectIdentifier, ENT_QUOTES, 'UTF-8') ?>.onclick = function() {
        if (video_<?php echo htmlentities($videoObjectIdentifier, ENT_QUOTES, 'UTF-8') ?>.paused) {
            video_<?php echo htmlentities($videoObjectIdentifier, ENT_QUOTES, 'UTF-8') ?>.play();
        } else {
            video_<?php echo htmlentities($videoObjectIdentifier, ENT_QUOTES, 'UTF-8') ?>.pause();
        }
        return false;
    };

    document.getElementById('<?php echo htmlentities($videoObjectIdentifier, ENT_QUOTES, 'UTF-8') ?>').addEventListener('error', function(e) {
        document.getElementById('b_<?php echo htmlentities($videoObjectIdentifier, ENT_QUOTES, 'UTF-8') ?>').style.display = 'none';
        switch (e.target.error.code) {
    	    case e.target.error.MEDIA_ERR_ABORTED:
       		case e.target.error.MEDIA_ERR_NETWORK:
      		case e.target.error.MEDIA_ERR_DECODE:
      		case e.target.error.MEDIA_ERR_SRC_NOT_SUPPORTED:
    	  		document.getElementById('<?php echo htmlentities($videoObjectIdentifier, ENT_QUOTES, 'UTF-8') ?>').style.display = 'none';
          		document.getElementById('e_<?php echo htmlentities($videoObjectIdentifier, ENT_QUOTES, 'UTF-8') ?>').style.display = 'block';
        	break;
      		default:
        	return;
      }
    }, true);

    function trackError() {
    	var url = '<?php echo htmlentities($logger, ENT_QUOTES, 'UTF-8') ?>';
    	var data = '<?php echo htmlentities($cachePath, ENT_QUOTES, 'UTF-8') ?>';
    	try {
    		x = new(this.XMLHttpRequest || ActiveXObject)('MSXML2.XMLHTTP.3.0');
    		x.open(data ? 'POST' : 'GET', url, 1);
    		x.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
    		x.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
    		x.send(data)
    	} catch (e) {
    		window.console && console.log(e);
    	}
    };
    
    var obj_<?php echo $licid;?> = document.querySelector("[data-licid='<?php echo $licid;?>']");
    var wrapper_<?php echo $licid;?> = obj_<?php echo $licid;?>.parentNode;
    if((' ' + wrapper_<?php echo $licid?>.className + ' ').indexOf(' edu_wrapper ') > -1) {
	    var objWidth_<?php echo $licid;?> = obj_<?php echo $licid;?>.clientWidth + 'px';
	    for (var i = 0; i < wrapper_<?php echo $licid;?>.childNodes.length; i++) {
	    	if (wrapper_<?php echo $licid;?>.childNodes[i].className == "license") {
	        	wrapper_<?php echo $licid;?>.childNodes[i].style.width = objWidth_<?php echo $licid;?>;
	    		wrapper_<?php echo $licid;?>.style.height = 'auto';
	          	break;
	        }
	    }
    }
</script>