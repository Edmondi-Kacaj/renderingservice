<?php
global $Locale, $Translate;
$msg = array();
$id = uniqid();
?>

<style>
    <?php include(dirname(__FILE__) . '/../../css/dynamic.php'); ?>
    <?php include(dirname(__FILE__) . '/../../css/metadata.css'); ?>
</style>

<?php //echo $h5p_scripts; ?>

<div class="edusharing_rendering_wrapper h5p-org-content-wrapper" vocab="http://schema.org/" typeof="WebPage">
    <h1 class="edusharing_rendering_content_title"><?php echo $title ?></h1>
    <div class="edusharing_rendering_content_wrapper" role="main">
        <iframe id="<?php echo $h5pId?>" src="<?php echo $iframeurl?>" class="h5p-iframe h5p-initialized" data-content-id="<?php echo $h5pId?>" style="width:85%;height:auto;border:none" allowfullscreen="allowfullscreen" frameBorder="0" scrolling="no"></iframe>
    </div>
    <?php echo $metadata; ?>
</div>



<script>
/*

@todo adjust height on resize (following code works but h5p content must resize itself which does not work yet)

    var height = 0;
    var width = parseInt(window.getComputedStyle(document.getElementById('<?php echo $id?>')).getPropertyValue('width').replace(/px/i, ''));
    var ratio = 0;

    function setRatio() {
        ratio = height / width;
    }

    window.onresize = function(event) {
        var wwidth =  parseInt(window.getComputedStyle(document.getElementById('<?php echo $id?>')).getPropertyValue('width').replace(/px/i, ''));
        wwidth = parseInt(wwidth);
        height = Math.ceil(wwidth*ratio);
      //  alert(wwidth + ' ' + height);
        document.getElementById('<?php echo $h5pId?>').style.height=height+'px';
    }
*/
    //set height to value received from iframe document
    window.addEventListener('message', function(e) {
        var eventName = e.data[0];
        var data = e.data[1];
        switch(eventName) {
            case 'setHeight':
                //height = data;
                document.getElementById('<?php echo $h5pId?>').style.height=data+'px';
                //setRatio();
                break;
        }
    }, false);


//@todo xapi

</script>
<?php
$downloadUrl = Config::get('downloadUrl');
if(!empty($downloadUrl))
    echo '<script>try{window.ngRender.setDownloadUrl("'.$downloadUrl.'");}catch(err){}</script>';
?>
